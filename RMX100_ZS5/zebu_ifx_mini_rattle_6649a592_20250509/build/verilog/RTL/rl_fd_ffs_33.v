// Library ARCv5EM-3.5.999999999
//----------------------------------------------------------------------------
//
// Copyright 2010-2023 Synopsys, Inc. All rights reserved.
//
/// SYNOPSYS CONFIDENTIAL - This is an unpublished, proprietary 
// work of Synopsys, Inc., and is fully protected under copyright and 
// trade secret laws. You may not view, use, disclose, copy, or distribute 
// this file or any information contained herein except pursuant to a 
// valid written license from Synopsys, Inc.
//
// Certain materials incorporated herein are copyright (C) 2010 - 2023, The
// University Court of the University of Edinburgh. All Rights Reserved.
//
// The entire notice above must be reproduced on all authorized copies.
//
//----------------------------------------------------------------------------
//
// Description:
//
// FAST DIVIDER SUPPORT MODULE.
// find most significant non-sign bit in a 33-bit extended integer (1 bit added
// for unsigned) 
// This .vpp source file must be pre-processed with the Verilog Pre-Processor
// (VPP) to produce the equivalent .v file using a command line such as:
//
//   vpp +q +o rl_fd_ffs_33.vpp
//
// ===========================================================================
//
module rl_fd_ffs_33 ( din, pos, zero_det, minus_1_det, max_neg_det );

input   [32:0]     din;          // 33-bit
output  [6:0]      pos;          // position of first non-sign bit of din
output             zero_det;     // zero detect, i.e. din == 0
output             minus_1_det;  // for corner case 0x80000_0000/-1
output             max_neg_det;  // 0x80000_0000 signed

reg     [6:0]      pos;          // actual bit position, value -1 means din is
                                 // either 0 or -1
reg                zero_det;
reg                minus_1_det;
reg                max_neg_det;


// Main code for the magnitude estimation logic
// Counts the number of leading 1's or 0's
// Also detects specific constants

always @ (*)
begin: FFS_33_PROC

  zero_det    = 1'b0;   // defaults
  minus_1_det = 1'b0;
  max_neg_det = 1'b0;
  
  casez (din)

    33'b000_0000000000_0000000000_0000000000: begin
                                                zero_det = 1'b1; // din == 0
                                                pos = 7'h7f;     // -1, covered
                                                         // by the default term
                                              end

    33'b111_1111111111_1111111111_1111111111: begin
                                                minus_1_det = 1'b1;
                                                pos = 7'h7f;     // -1, covered
                                                         // by the default term
                                              end

    33'b000_0000000000_0000000000_0000000001,
    33'b111_1111111111_1111111111_1111111110:   pos =  7'd0;
    33'b000_0000000000_0000000000_000000001?,
    33'b111_1111111111_1111111111_111111110?:   pos =  7'd1;
    33'b000_0000000000_0000000000_00000001??,
    33'b111_1111111111_1111111111_11111110??:   pos =  7'd2;
    33'b000_0000000000_0000000000_0000001???,
    33'b111_1111111111_1111111111_1111110???:   pos =  7'd3;
    33'b000_0000000000_0000000000_000001????,
    33'b111_1111111111_1111111111_111110????:   pos =  7'd4;
    33'b000_0000000000_0000000000_00001?????,
    33'b111_1111111111_1111111111_11110?????:   pos =  7'd5;
    33'b000_0000000000_0000000000_0001??????,
    33'b111_1111111111_1111111111_1110??????:   pos =  7'd6;  
    33'b000_0000000000_0000000000_001???????,
    33'b111_1111111111_1111111111_110???????:   pos =  7'd7;
    33'b000_0000000000_0000000000_01????????,
    33'b111_1111111111_1111111111_10????????:   pos =  7'd8;
    33'b000_0000000000_0000000000_1?????????,
    33'b111_1111111111_1111111111_0?????????:   pos =  7'd9;  

    33'b000_0000000000_0000000001_??????????,
    33'b111_1111111111_1111111110_??????????:   pos = 7'd10;
    33'b000_0000000000_000000001?_??????????,
    33'b111_1111111111_111111110?_??????????:   pos = 7'd11;
    33'b000_0000000000_00000001??_??????????,
    33'b111_1111111111_11111110??_??????????:   pos = 7'd12;
    33'b000_0000000000_0000001???_??????????,
    33'b111_1111111111_1111110???_??????????:   pos = 7'd13;
    33'b000_0000000000_000001????_??????????,
    33'b111_1111111111_111110????_??????????:   pos = 7'd14;
    33'b000_0000000000_00001?????_??????????,
    33'b111_1111111111_11110?????_??????????:   pos = 7'd15;
    33'b000_0000000000_0001??????_??????????,
    33'b111_1111111111_1110??????_??????????:   pos = 7'd16;  
    33'b000_0000000000_001???????_??????????,
    33'b111_1111111111_110???????_??????????:   pos = 7'd17;
    33'b000_0000000000_01????????_??????????,
    33'b111_1111111111_10????????_??????????:   pos = 7'd18;
    33'b000_0000000000_1?????????_??????????,
    33'b111_1111111111_0?????????_??????????:   pos = 7'd19;  

    33'b000_0000000001_??????????_??????????,
    33'b111_1111111110_??????????_??????????:   pos = 7'd20;
    33'b000_000000001?_??????????_??????????,
    33'b111_111111110?_??????????_??????????:   pos = 7'd21;
    33'b000_00000001??_??????????_??????????,
    33'b111_11111110??_??????????_??????????:   pos = 7'd22;
    33'b000_0000001???_??????????_??????????,
    33'b111_1111110???_??????????_??????????:   pos = 7'd23;
    33'b000_000001????_??????????_??????????,
    33'b111_111110????_??????????_??????????:   pos = 7'd24;
    33'b000_00001?????_??????????_??????????,
    33'b111_11110?????_??????????_??????????:   pos = 7'd25;
    33'b000_0001??????_??????????_??????????,
    33'b111_1110??????_??????????_??????????:   pos = 7'd26;  
    33'b000_001???????_??????????_??????????,
    33'b111_110???????_??????????_??????????:   pos = 7'd27;
    33'b000_01????????_??????????_??????????,
    33'b111_10????????_??????????_??????????:   pos = 7'd28;
    33'b000_1?????????_??????????_??????????,
    33'b111_0?????????_??????????_??????????:   pos = 7'd29;    
    33'b001_??????????_??????????_??????????:   pos = 7'd30;
    
    33'b110_??????????_??????????_??????????: begin
                                                max_neg_det =
                                                  din[29:0] == 30'h0 ? 1'b1 :
                                                                       1'b0;
                                                pos = 7'd30;
                                              end

    33'b01?_??????????_??????????_??????????,
    33'b10?_??????????_??????????_??????????:   pos = 7'd31;
  
    //  default should never be reached 
    default:                                    pos = 7'h7f;   // -1
  
  endcase
end

endmodule   // rl_fd_ffs_33
